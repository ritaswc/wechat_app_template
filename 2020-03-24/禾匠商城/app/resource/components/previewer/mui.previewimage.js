!function(u,p){function t(e){this.options=u.extend(!0,{id:"__MUI_PREVIEWIMAGE",zoom:!0,header:'<span class="mui-preview-indicator"></span>',footer:""},e||{}),this.init(),this.initEvent()}var a="__DEFAULT",i=document.createElement("div"),e=t.prototype;e.init=function(){var e=this.options,t=document.getElementById(this.options.id);t||(i.innerHTML='<div id="{{id}}" class="mui-slider mui-preview-image mui-fullscreen"><div class="mui-preview-header">{{header}}</div><div class="mui-slider-group"></div><div class="mui-preview-footer mui-hidden">{{footer}}</div><div class="mui-preview-loading"><span class="mui-spinner mui-spinner-white"></span></div></div>'.replace(/\{\{id\}\}/g,this.options.id).replace("{{header}}",e.header).replace("{{footer}}",e.footer),document.body.appendChild(i.firstElementChild),t=document.getElementById(this.options.id)),this.element=t,this.scroller=this.element.querySelector(u.classSelector(".slider-group")),this.indicator=this.element.querySelector(u.classSelector(".preview-indicator")),this.loader=this.element.querySelector(u.classSelector(".preview-loading")),e.footer&&this.element.querySelector(u.classSelector(".preview-footer")).classList.remove(u.className("hidden")),this.addImages()},e.initEvent=function(){var s=this;u(document.body).on("click","img[data-preview-src]",function(){return s.isAnimationing()||s.open(this),!1});var e=null,t=function(){e=e||u.later(function(){s.isInAnimation=!0,s.loader.removeEventListener("tap",t),s.scroller.removeEventListener("tap",t),s.close()},300)};this.scroller.addEventListener("doubletap",function(){e&&(e.cancel(),e=null)}),this.element.addEventListener("webkitAnimationEnd",function(){s.element.classList.contains(u.className("preview-out"))?(s.element.style.display="none",s.element.classList.remove(u.className("preview-out")),e=null):(s.loader.addEventListener("tap",t),s.scroller.addEventListener("tap",t)),s.isInAnimation=!1}),this.element.addEventListener("slide",function(e){if(s.options.zoom){var t=s.element.querySelector(".mui-zoom-wrapper:nth-child("+(s.lastIndex+1)+")");t&&u(t).zoom().setZoom(1)}var i=e.detail.slideNumber;s.lastIndex=i,s.indicator&&(s.indicator.innerText=i+1+"/"+s.currentGroup.length),s._loadItem(i)})},e.isAnimationing=function(){return!!this.isInAnimation||!(this.isInAnimation=!0)},e.addImages=function(e,t){this.groups={};var i=[];if((i=e?e===a?document.querySelectorAll("img[data-preview-src]:not([data-preview-group])"):document.querySelectorAll("img[data-preview-src][data-preview-group='"+e+"']"):document.querySelectorAll("img[data-preview-src]")).length)for(var s=0,n=i.length;s<n;s++)this.addImage(i[s])},e.addImage=function(e){var t=e.getAttribute("data-preview-group");t=t||a,this.groups[t]||(this.groups[t]=[]);var i=e.getAttribute("src");if(e.__mui_img_data&&e.__mui_img_data.src===i)this.groups[t].push(e.__mui_img_data);else{var s=e.getAttribute("data-preview-src"),n={src:i,lazyload:i===(s=s||i)?"":s,loaded:i===s,sWidth:0,sHeight:0,sTop:0,sLeft:0,sScale:1,el:e};this.groups[t].push(n),e.__mui_img_data=n}},e.empty=function(){this.scroller.innerHTML=""},e._initImgData=function(e,t){if(!e.sWidth){var i=e.el;e.sWidth=i.offsetWidth,e.sHeight=i.offsetHeight;var s=u.offset(i);e.sTop=s.top,e.sLeft=s.left,e.sScale=Math.max(e.sWidth/p.innerWidth,e.sHeight/p.innerHeight)}t.style.webkitTransform="translate3d(0,0,0) scale("+e.sScale+")"},e._getScale=function(e,t){var i=e.width/t.width,s=e.height/t.height;return i<=s?e.height/(t.height*i):e.width/(t.width*s)},e._imgTransitionEnd=function(e){var t=e.target;t.classList.remove(u.className("transitioning")),t.removeEventListener("webkitTransitionEnd",this._imgTransitionEnd.bind(this))},e._loadItem=function(e,t){var i=this.scroller.querySelector(u.classSelector(".slider-item:nth-child("+(e+1)+")")),s=this.currentGroup[e],n=i.querySelector("img");if(this._initImgData(s,n),t){var a=this._getPosition(s);n.style.webkitTransitionDuration="0ms",n.style.webkitTransform="translate3d("+a.x+"px,"+a.y+"px,0) scale("+s.sScale+")",n.offsetHeight}if(!s.loaded&&n.getAttribute("data-preview-lazyload")){var r=this;r.loader.classList.add(u.className("active")),n.style.webkitTransitionDuration="0.5s",n.addEventListener("webkitTransitionEnd",r._imgTransitionEnd.bind(r)),n.style.webkitTransform="translate3d(0,0,0) scale("+s.sScale+")",this.loadImage(n,function(){s.loaded=!0,n.src=s.lazyload,r._initZoom(i,this.width,this.height),n.classList.add(u.className("transitioning")),n.addEventListener("webkitTransitionEnd",r._imgTransitionEnd.bind(r)),n.setAttribute("style",""),n.offsetHeight,r.loader.classList.remove(u.className("active"))})}else s.lazyload&&(n.src=s.lazyload),this._initZoom(i,n.width,n.height),n.classList.add(u.className("transitioning")),n.addEventListener("webkitTransitionEnd",this._imgTransitionEnd.bind(this)),n.setAttribute("style",""),n.offsetHeight;this._preloadItem(e+1),this._preloadItem(e-1)},e._preloadItem=function(e){var t=this.scroller.querySelector(u.classSelector(".slider-item:nth-child("+(e+1)+")"));if(t){var i=this.currentGroup[e];if(!i.sWidth){var s=t.querySelector("img");this._initImgData(i,s)}}},e._initZoom=function(e,t,i){if(this.options.zoom&&!e.getAttribute("data-zoomer"))if("IMG"===e.querySelector(u.classSelector(".zoom")).tagName){var s=this._getScale({width:e.offsetWidth,height:e.offsetHeight},{width:t,height:i});u(e).zoom({maxZoom:Math.max(s,1)})}else u(e).zoom()},e.loadImage=function(e,t){function i(){t&&t.call(this)}var s=new Image;s.onload=i,s.onerror=i,s.src=e.getAttribute("data-preview-lazyload")},e.getRangeByIndex=function(e,t){return{from:0,to:t-1}},e._getPosition=function(e){var t=e.sLeft-p.pageXOffset,i=e.sTop-p.pageYOffset;return{left:t,top:i,x:t-(p.innerWidth-e.sWidth)/2,y:i-(p.innerHeight-e.sHeight)/2}},e.refresh=function(e,t){for(var i=(this.currentGroup=t).length,s=[],n=this.getRangeByIndex(e,i),a=n.from,r=n.to+1,o=e,l="",d="",c=(p.innerWidth,p.innerHeight,0);a<r;a++,c++){var m=t[a],h="";m.sWidth&&(h="-webkit-transform:translate3d(0,0,0) scale("+m.sScale+");transform:translate3d(0,0,0) scale("+m.sScale+")"),d='<div class="mui-slider-item mui-zoom-wrapper {{className}}"><div class="mui-zoom-scroller"><img src="{{src}}" data-preview-lazyload="{{lazyload}}" style="{{style}}" class="mui-zoom"></div></div>'.replace("{{src}}",m.src).replace("{{lazyload}}",m.lazyload).replace("{{style}}",h),l=a===e?(o=c,u.className("active")):"",s.push(d.replace("{{className}}",l))}this.scroller.innerHTML=s.join(""),this.element.style.display="block",this.element.classList.add(u.className("preview-in")),this.lastIndex=o,this.element.offsetHeight,u(this.element).slider().gotoItem(o,0),this.indicator&&(this.indicator.innerText=o+1+"/"+this.currentGroup.length),this._loadItem(o,!0)},e.openByGroup=function(e,t){e=Math.min(Math.max(0,e),this.groups[t].length-1),this.refresh(e,this.groups[t])},e.open=function(e,t){this.element.classList.contains(u.className("preview-in"))||("number"==typeof e?(t=t||a,this.addImages(t,e),this.openByGroup(e,t)):(t=(t=e.getAttribute("data-preview-group"))||a,this.addImages(t,e),this.openByGroup(this.groups[t].indexOf(e.__mui_img_data),t)))},e.close=function(e,t){this.element.classList.remove(u.className("preview-in")),this.element.classList.add(u.className("preview-out"));var i=this.scroller.querySelector(u.classSelector(".slider-item:nth-child("+(this.lastIndex+1)+")")).querySelector("img");if(i){i.classList.add(u.className("transitioning"));var s=this.currentGroup[this.lastIndex],n=this._getPosition(s),a=n.left,r=n.top;r>p.innerHeight||a>p.innerWidth||r<0||a<0?(i.style.opacity=0,i.style.webkitTransitionDuration="0.5s",i.style.webkitTransform="scale("+s.sScale+")"):(this.options.zoom&&u(i.parentNode.parentNode).zoom().toggleZoom(0),i.style.webkitTransitionDuration="0.5s",i.style.webkitTransform="translate3d("+n.x+"px,"+n.y+"px,0) scale("+s.sScale+")")}for(var o=this.element.querySelectorAll(u.classSelector(".zoom-wrapper")),l=0,d=o.length;l<d;l++)u(o[l]).zoom().destory()},e.isShown=function(){return this.element.classList.contains(u.className("preview-in"))};var s=null;u.previewImage=function(e){return s=s||new t(e)},u.getPreviewImage=function(){return s}}(mui,window);